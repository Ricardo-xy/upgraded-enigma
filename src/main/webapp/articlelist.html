<!doctype html>
<html lang="zxx">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="layui/css/layui.css"/>

    <!-- Bootstrap Min CSS -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <!-- Owl Theme Default Min CSS -->
    <link rel="stylesheet" href="assets/css/owl.theme.default.min.css">
    <!-- Owl Carousel Min CSS -->
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
    <!-- Animate Min CSS -->
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <!-- Boxicons Min CSS -->
    <link rel="stylesheet" href="assets/css/boxicons.min.css">
    <!-- Magnific Popup Min CSS -->
    <link rel="stylesheet" href="assets/css/magnific-popup.min.css">
    <!-- Flaticon CSS -->
    <link rel="stylesheet" href="assets/css/flaticon.css">
    <!-- Meanmenu Min CSS -->
    <link rel="stylesheet" href="assets/css/meanmenu.min.css">
    <!-- Nice Select Min CSS -->
    <link rel="stylesheet" href="assets/css/nice-select.min.css">
    <!-- Odometer Min CSS-->
    <link rel="stylesheet" href="assets/css/odometer.min.css">
    <!-- Date Picker CSS-->
    <link rel="stylesheet" href="assets/css/date-picker.min.css">
    <!-- Muli Fonts Min CSS-->
    <link rel="stylesheet" href="assets/css/muli-fonts.css">
    <!-- Style CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- Responsive CSS -->
    <link rel="stylesheet" href="assets/css/responsive.css">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/images/favicon.png">

    <link rel="stylesheet" href="css/global.css"  media="all">

    <link rel="stylesheet" href="kindeditor/themes/default/default.css" />
    <link rel="stylesheet" href="kindeditor/plugins/code/prettify.css" />
    <script charset="utf-8" src="kindeditor/plugins/code/prettify.js"></script>
    <script charset="utf-8" src="kindeditor/kindeditor-all.js"></script>
    <script charset="utf-8" src="kindeditor/lang/zh-CN.js"></script>
    <script>
        KindEditor.ready(function(K) {
            window.editor = K.create('#editor_id');
        });
    </script>
    <script>
        KindEditor.ready(function(K) {
            K.create('textarea[name="note"]', {
                uploadJson : 'kindeditor/jsp/upload_json.jsp',
                fileManagerJson : 'kindeditor/jsp/file_manager_json.jsp',
                allowFileManager : true,
                allowImageUpload : true,
                autoHeightMode : true,
                afterCreate : function() {this.loadPlugin('autoheight');},
                afterBlur : function(){ this.sync(); }  //Kindeditor下获取文本框信息
            });
        });
    </script>
    <!-- Title -->
    <title>校园兼职服务信息管理系统</title>
</head>

<body>
<!-- Start Preloader Area -->
<div class="preloader">
    <div class="lds-ripple">
        <div></div>
        <div></div>
    </div>
</div>
<!-- End Preloader Area -->

<!-- Start Header Area -->
<div id="iframetop"></div>
<!-- End Header Area -->

<!-- Start Page Title Area -->
<div class="page-title-area">
    <div class="container">
        <div class="page-title-content" style="text-align: center">
            <h3>在线论坛</h3>
            <ul>
                <li>
                    <a href="index.html">
                        首页
                    </a>
                </li>
                <li class="active">在线论坛</li>
            </ul>
        </div>
    </div>
</div>
<!-- End Page Title Area -->
<!--//搜索-->
<!--<div class="row">-->
<!--    <div class="col-lg-5">-->
<!--        <div class="form-group">-->
<!--            <input type="text" v-model="key" class="form-control"  placeholder="标题或企业">-->
<!--        </div>-->
<!--    </div>-->
<!--    &lt;!&ndash;<div class="col-lg-4">&ndash;&gt;-->
<!--    &lt;!&ndash;<div class="form-group">&ndash;&gt;-->
<!--    &lt;!&ndash;<input type="text" class="form-control" id="job-title-2" placeholder="城市或">&ndash;&gt;-->
<!--    &lt;!&ndash;</div>&ndash;&gt;-->
<!--    &lt;!&ndash;</div>&ndash;&gt;-->
<!--    <div class="col-lg-3">-->
<!--        <button  class="default-btn" @click="getcompanylist2()">-->
<!--            <i class="bx bx-search"></i>-->
<!--            搜索企业-->
<!--        </button>-->
<!--    </div>-->
<!--</div>-->
<!-- Start Candidates Profile Area -->
<section class="candidates-profile-area ptb-100" style="padding-top: 20px">
    <div class="container" id="app">
        <!--论坛-->
        <div style="padding:0px 30px;">

            <div class="layui-container" style="border: 1px solid #B8B8B8;width: auto;">
                <div class="layui-row layui-col-space15">
                    <div class="layui-col-md12">

                        <div class="fly-panel" style="margin-bottom: 0;">

                            <div class="fly-panel-title fly-filter" style="font-weight: bold">
                                <a href="articlelist.html" >全部</a>
                                <template v-for="(section,i) in sectionlist">
                                    <span class="fly-mid"></span>
                                    <a :href="['articlelist.html?categoryid='+section.id]"  :style="categoryid == section.id?'border-bottom: 2px solid #0BAC4F':''" class="layui-this">{{section.name}}</a>
                                </template>
                            </div>

                            <ul class="fly-list">
                                <li v-for="(article,i) in articlelist" style="height: auto;">
                                    <a href="" class="fly-avatar">
                                        <img :src="['upload/'+article.member.filename]" alt="article.member.tname" >
                                    </a>
                                    <h2 style="margin-bottom: 0px;">
                                        <a class="layui-badge" style="top:0px;height: 18px;">{{article.section.name}}</a>
                                        <a :href="['articledetails.html?id='+article.id]">{{article.title }}</a>
                                    </h2>
                                    <div class="fly-list-info">
                                        <a href="#" link>
                                            <cite>{{article.member.tname}}</cite>
                                            <i class="iconfont icon-renzheng" title="实名认证"></i>
                                            <!--
                                            <i class="iconfont icon-renzheng" title="认证信息：XXX"></i>
                                            <i class="layui-badge fly-badge-vip">VIP3</i>
                                            -->
                                        </a>
                                        <span>{{article.savetime}}</span>

                                        <!--<span class="fly-list-kiss layui-hide-xs" title="悬赏飞吻"><i class="iconfont icon-kiss"></i> 60</span>
                                        <span class="layui-badge fly-badge-accept layui-hide-xs">已结</span>-->
                                        <span class="fly-list-nums">
                                                     <i class="iconfont icon-pinglun1" title="跟帖"></i>{{article.replylist.length}}
                                             </span>
                                    </div>
                                    <div class="fly-list-badge">
                                        <span v-if="article.isjh=='yes'" class="layui-badge layui-bg-red">精帖</span>
                                    </div>
                                </li>
                            </ul>
                            <div id="demo1" style="text-align: center"></div>

                        </div>
                    </div>

                </div>
            </div>


            <div class="layui-container" style="border: 1px solid #B8B8B8;margin-top: 20px;width: auto;">
                <div style="background: #E3E3E3;color:#0BAC4F;font-weight: bold;padding: 10px 10px;border-bottom: 1px solid #B8B8B8;">快速发帖</div>
                <div class="layui-row layui-col-space15">
                    <div class="layui-col-md8" style="padding: 20px 50px;">

                        <form class="layui-form" >
                            <div class="layui-form-item">
                                <label class="layui-form-label">标题</label>
                                <div class="layui-input-block">
                                    <input type="text" v-model="title"  placeholder="请输入标题" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">版块</label>
                                <div class="layui-input-block">
                                    <select v-model="sectionid" id="sectionid">
                                        <option value="">请选择版块</option>
                                        <option v-for="section in sectionlist" :value="section.id">{{section.name}}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-form-item layui-form-text">
                                <label class="layui-form-label">内容</label>
                                <div class="layui-input-block">
                                    <textarea name="content" id="editor_id" placeholder="请输入内容" style="width: 100%" class="layui-textarea"></textarea>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <a class="layui-btn"   lay-submit lay-filter="formDemo" @click="add()">立即提交</a>
                                </div>
                            </div>
                        </form>

                    </div>
                </div>
            </div>

        </div>



        <!--论坛-->
    </div>
</section>
<!-- End Candidates Profile Area -->

<!-- Start Subscribe Area -->

<!-- End Subscribe Area -->

<!-- Start Footer Area -->

<!-- End Footer Area -->

<!-- Start Copy Right Area -->

<div class="copy-right-area" id="iframefoot">
</div>

<!-- End Copy Right Area -->

<!-- Start Go Top Area -->
<div class="go-top">
    <i class="bx bx-chevrons-up"></i>
    <i class="bx bx-chevrons-up"></i>
</div>
<!-- End Go Top Area -->


<!-- Jquery Min JS -->
<script src="assets/js/jquery.min.js"></script>
<!-- Popper Min JS -->
<script src="assets/js/popper.min.js"></script>
<!-- Bootstrap Min JS -->
<script src="assets/js/bootstrap.min.js"></script>
<!-- Meanmenu Min JS -->
<script src="assets/js/meanmenu.min.js"></script>
<!-- Wow Min JS -->
<script src="assets/js/wow.min.js"></script>
<!-- Owl Carousel Min JS -->
<script src="assets/js/owl.carousel.min.js"></script>
<!-- Nice Select Min JS -->
<script src="assets/js/nice-select.min.js"></script>
<!-- Magnific Popup Min JS -->
<script src="assets/js/magnific-popup.min.js"></script>
<!-- Mixitup JS -->
<script src="assets/js/jquery.mixitup.min.js"></script>
<!-- Appear Min JS -->
<script src="assets/js/appear.min.js"></script>
<!-- Odometer Min JS -->
<script src="assets/js/odometer.min.js"></script>
<!-- Range Slider Min JS -->
<script src="assets/js/range-slider.min.js"></script>
<!-- Datepicker Min JS -->
<script src="assets/js/bootstrap-datepicker.min.js"></script>
<!-- Form Validator Min JS -->
<script src="assets/js/form-validator.min.js"></script>
<!-- Contact JS -->
<script src="assets/js/contact-form-script.js"></script>
<!-- Ajaxchimp Min JS -->
<script src="assets/js/ajaxchimp.min.js"></script>
<!-- Custom JS -->
<script src="assets/js/custom.js"></script>

<script type="text/javascript" src="axios/vue.js"></script>
<script type="text/javascript" src="axios/axios.min.js"></script>
<script type="text/javascript" src="axios/qs.js"></script>
<script type="text/javascript" src="axios/getUrlParams.js"></script>
<script type="text/javascript" src="layer/jquery-2.0.3.min.js"></script>
<script type="text/javascript" src="layer/layer.js"></script>
<script type="text/javascript" src="layui/layui.js"></script>
<script type="text/javascript">
    var qs = Qs
    var categoryid = UrlParam.paramValues("categoryid")==undefined?"":UrlParam.paramValues("categoryid").toString();
    var vmm = new Vue({
        el:"#app",
        data:{
            categoryid:categoryid,
            title:"",
            sectionid:"",
            content:"",
            sectionlist:[],
            articlelist:[],
            keyword:"",
            pageSize:10,
        },
        mounted(){
            sessionStorage.setItem("banermenus", "articlelist")
            this.getsectionlist()
            this.getarticlelist()
            layui.use(['form'], function(){
                var form = layui.form
            })

        },
        methods:{

            add(){
                axios.post('checkmember',qs.stringify({
                })).then(response =>{
                    if(response.data.data==200){

                    this.sectionid = $("#sectionid").val()
                    this.content = window.editor.html()
                    if(this.title==""){
                        layer.msg("标题不能为空",{icon:5})
                        return false;
                    }

                    if(this.sectionid==""){
                        layer.msg("请选择版块",{icon:5})
                        return false;
                    }


                    if(this.content==""){
                        layer.msg("发表内容不能为空",{icon:5})
                        return false;
                    }

                    axios.post('articleAdd',qs.stringify({
                        title:this.title,
                        sectionid:this.sectionid,
                        content:this.content,
                    })).then(response =>{
                        layer.msg("发表成功",{icon:6})
                    this.getarticlelist()
                }).catch(error =>{
                        console.log(error)
                })

                }else{
                    location.replace("login.html")
                }
            }).catch(error =>{
                    console.log(error)
            })
            },


            getarticlelist() {
                axios.post('admin/articleList',qs.stringify({
                    sectionid:this.categoryid,
                    pageSize:this.pageSize
                })).then(response =>{
                    layui.use(['laypage', 'layer'], function(){
                    var laypage = layui.laypage
                        ,layer = layui.layer;
                    //总页数大于页码总数
                    laypage.render({
                        elem: 'demo1'
                        ,limit:vmm.pageSize
                        ,count: response.data.list.length //数据总数
                        ,jump: function(obj,first){
                            vmm.current_page(obj.curr,vmm.pageSize)
                            console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                        }
                    });
                });
            }).catch(error =>{
                    console.log(error)
            })
            },

            // getarticlelist2() {
            //     axios.post('articleList',qs.stringify({
            //         key:this.key,
            //         pageSize:this.pageSize
            //     })).then(response =>{
            //         layui.use(['laypage', 'layer'], function(){
            //             var laypage = layui.laypage
            //                 ,layer = layui.layer;
            //             //总页数大于页码总数
            //             laypage.render({
            //                 elem: 'demo1'
            //                 ,limit:vmm.pageSize
            //                 ,curr:vmm.pageNum
            //                 ,count: response.data.list.length //数据总数
            //                 ,jump: function(obj,first){
            //                     vmm.pageNum = obj.curr
            //                     vmm.current_page(obj.curr,vmm.pageSize)
            //                     console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
            //                 }
            //             });
            //         });
            //     }).catch(error =>{
            //         console.log(error)
            //     })
            // },
            current_page(page,pageSize){
                axios.post('admin/articleList',qs.stringify({
                    sectionid:this.categoryid,
                    pageNum:page,
                    pageSize:pageSize,
                })).then(response =>{
                    this.articlelist = response.data.pageInfo.list
                console.log(this.articlelist)
            }).catch(error =>{
                    console.log(error)
            })
            },



            getsectionlist(){
                axios.post('admin/sectionList',qs.stringify({
                })).then(response =>{
                    this.sectionlist = response.data.list
            }).catch(error =>{
                    console.log(error)
            })
            },

        }
    })
    window.onload = function () {
        $("#iframetop").load("top.html")
        $("#iframefoot").load("foot.html")
    }
</script>
</body>
</html>