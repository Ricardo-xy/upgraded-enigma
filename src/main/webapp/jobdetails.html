<!doctype html>
<html lang="zxx">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="layui/css/layui.css"/>

    <!-- Bootstrap Min CSS -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <!-- Owl Theme Default Min CSS -->
    <link rel="stylesheet" href="assets/css/owl.theme.default.min.css">
    <!-- Owl Carousel Min CSS -->
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
    <!-- Animate Min CSS -->
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <!-- Boxicons Min CSS -->
    <link rel="stylesheet" href="assets/css/boxicons.min.css">
    <!-- Magnific Popup Min CSS -->
    <link rel="stylesheet" href="assets/css/magnific-popup.min.css">
    <!-- Flaticon CSS -->
    <link rel="stylesheet" href="assets/css/flaticon.css">
    <!-- Meanmenu Min CSS -->
    <link rel="stylesheet" href="assets/css/meanmenu.min.css">
    <!-- Nice Select Min CSS -->
    <link rel="stylesheet" href="assets/css/nice-select.min.css">
    <!-- Odometer Min CSS-->
    <link rel="stylesheet" href="assets/css/odometer.min.css">
    <!-- Date Picker CSS-->
    <link rel="stylesheet" href="assets/css/date-picker.min.css">
    <!-- Muli Fonts Min CSS-->
    <link rel="stylesheet" href="assets/css/muli-fonts.css">
    <!-- Style CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- Responsive CSS -->
    <link rel="stylesheet" href="assets/css/responsive.css">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/images/favicon.png">
    <!-- Title -->
    <title>校园兼职服务信息管理系统</title>
</head>

<body>
<!-- Start Preloader Area -->
<div class="preloader">
    <div class="lds-ripple">
        <div></div>
        <div></div>
    </div>
</div>
<!-- End Preloader Area -->

<!-- Start Header Area -->
<div id="iframetop"></div>
<!-- End Header Area -->

<!-- Start Page Title Area -->
<div class="page-title-area">
    <div class="container">
        <div class="page-title-content" style="text-align: center">
            <h3>招聘信息</h3>
            <ul>
                <li>
                    <a href="index.html">
                        首页
                    </a>
                </li>
                <li class="active">招聘信息详情</li>
            </ul>
        </div>
    </div>
</div>
<!-- End Page Title Area -->

<!-- Start Candidates Profile Area -->
<section class="candidates-profile-area ptb-100" style="padding-top: 20px">
    <div class="container" id="app">
        <div class="row">
            <div class="col-lg-12">
                <div class="hot-jobs-list">
                    <div class="row align-items-center">
                        <div class="col-lg-2">
                            <div class="hot-jobs-img">
                                <img :src="['upload/'+job.company.filename]" alt="Image">
                            </div>
                        </div>

                        <div class="col-lg-7">
                            <div class="hot-jobs-content">
                                <h3>{{job.title}}</h3>
                                <!--<span class="sub-title">Finix loans & funding agency</span>-->
                                <ul style="font-size:14px;">
                                    <li>
                                        <ul style="display: flex;">
                                            <li style="width: 50%"><span>城市:</span> {{job.area.name}}</li>
                                            <li><span>职位:</span> {{job.category.name}}</li>
                                        </ul>
                                    </li>

                                    <li>
                                        <ul style="display: flex;">
                                            <li style="width: 50%"><span>薪资:</span> {{job.salary}}</li>
                                            <li><span>要求学历:</span> {{job.education}}</li>
                                        </ul>
                                    </li>

                                    <li>
                                        <ul style="display: flex;">
                                            <li style="width: 50%"><span>工作经验:</span> {{job.experience}}</li>
                                            <li><span>招聘人数:</span> {{job.num}}</li>
                                        </ul>
                                    </li>

                                    <li>
                                        <ul style="display: flex;">
                                            <li style="width: 50%"><span>浏览次数:</span> {{job.lookcs}}</li>
                                            <li><span>发布时间:</span> {{job.savetime}}</li>

                                        </ul>
                                    </li>

                                    <li>

                                        <a v-for="welfare in welfarearray" href="" style="display: inline-block;padding: 2px 5px;background-color: #EEEEEE;margin-right: 10px;border-radius: 3px 3px;font-size:12px;">{{welfare}}</a>

                                    </li>

                                </ul>
                            </div>
                        </div>

                        <div class="col-lg-3">
                            <div class="hot-jobs-btn">
                                <a href="javascript:;" @click="dz(job.id,1)" class="default-btn"><i class="layui-icon">&#xe6c6;</i>{{job.znum}}</a>
                                <a href="javascript:;" @click="dz(job.id,2)" class="default-btn"><i class="layui-icon">&#xe6c5;</i>{{job.cnum}}</a>
                                <a href="javascript:;" @click="apply(job.id)" class="default-btn">立即申请</a>
                                <a href="javascript:;" @click="topl(job.id)" class="default-btn">职位评论</a>
                                <!--<p><span>发布时间: </span>{{job.savetime}}</p>-->
                            </div>
                        </div>
                    </div>
                </div>

                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
                    <legend>职位详情</legend>
                </fieldset>

                <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
                    <ul class="layui-tab-title">
                        <li class="layui-this">职位描述</li>
                        <li>职位评论</li>

                    </ul>
                    <div class="layui-tab-content" style="height: 100%;">
                        <div class="layui-tab-item layui-show" v-html="job.content"></div>
                        <div class="layui-tab-item">

                            <table class="layui-table" lay-skin="line">
                                <thead>
                                <tr>
                                    <th>评论</th>
                                    <th>评论人</th>
                                    <th>时间</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="(comment,i) in commentlist">
                                    <td>{{comment.note}}</td>
                                    <td><img :src="['upload/'+comment.member.filename]" alt="Image" style="width: 50px;height: 50px;border-radius:50%;">{{comment.member.tname}}</td>
                                    <td>{{comment.savetime}}</td>
                                </tr>

                                <tr>
                                    <td colspan="3">
                                        <div class="pagination-area">
                                            <div id="demo1" style="text-align: center"></div>

                                        </div>
                                    </td>
                                </tr>

                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>

                <!--<div class="job-details-content">-->
                    <!--<h3>职位描述</h3>-->
                    <!--<p v-html="job.content">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Lorem ipsum dolor sit amet, consetetur</p>-->

                <!--</div>-->
            </div>


        </div>

    </div>
</section>
<!-- End Candidates Profile Area -->

<!-- Start Subscribe Area -->

<!-- End Subscribe Area -->

<!-- Start Footer Area -->

<!-- End Footer Area -->

<!-- Start Copy Right Area -->

<div class="copy-right-area" id="iframefoot">
</div>

<!-- End Copy Right Area -->

<!-- Start Go Top Area -->
<div class="go-top">
    <i class="bx bx-chevrons-up"></i>
    <i class="bx bx-chevrons-up"></i>
</div>
<!-- End Go Top Area -->


<!-- Jquery Min JS -->
<script src="assets/js/jquery.min.js"></script>
<!-- Popper Min JS -->
<script src="assets/js/popper.min.js"></script>
<!-- Bootstrap Min JS -->
<script src="assets/js/bootstrap.min.js"></script>
<!-- Meanmenu Min JS -->
<script src="assets/js/meanmenu.min.js"></script>
<!-- Wow Min JS -->
<script src="assets/js/wow.min.js"></script>
<!-- Owl Carousel Min JS -->
<script src="assets/js/owl.carousel.min.js"></script>
<!-- Nice Select Min JS -->
<script src="assets/js/nice-select.min.js"></script>
<!-- Magnific Popup Min JS -->
<script src="assets/js/magnific-popup.min.js"></script>
<!-- Mixitup JS -->
<script src="assets/js/jquery.mixitup.min.js"></script>
<!-- Appear Min JS -->
<script src="assets/js/appear.min.js"></script>
<!-- Odometer Min JS -->
<script src="assets/js/odometer.min.js"></script>
<!-- Range Slider Min JS -->
<script src="assets/js/range-slider.min.js"></script>
<!-- Datepicker Min JS -->
<script src="assets/js/bootstrap-datepicker.min.js"></script>
<!-- Form Validator Min JS -->
<script src="assets/js/form-validator.min.js"></script>
<!-- Contact JS -->
<script src="assets/js/contact-form-script.js"></script>
<!-- Ajaxchimp Min JS -->
<script src="assets/js/ajaxchimp.min.js"></script>
<!-- Custom JS -->
<script src="assets/js/custom.js"></script>

<script type="text/javascript" src="axios/vue.js"></script>
<script type="text/javascript" src="axios/axios.min.js"></script>
<script type="text/javascript" src="axios/qs.js"></script>
<script type="text/javascript" src="axios/getUrlParams.js"></script>
<script type="text/javascript" src="layer/jquery-2.0.3.min.js"></script>
<script type="text/javascript" src="layer/layer.js"></script>
<script type="text/javascript" src="layui/layui.js"></script>
<script type="text/javascript">
    var id = UrlParam.paramValues("id").toString()
    var pageNum = UrlParam.paramValues("pageNum")==null?1:UrlParam.paramValues("pageNum").toString()
    var qs = Qs
    var vmm = new Vue({
        el: '#app',
        data: {
            job: {
                company:"",
                area:"",
                category:"",
            },
            welfarearray:[],
            id:id,

            commentlist:[],
            pageSize:10,
            pageNum:pageNum,
        },
        mounted() {
            sessionStorage.setItem("banermenus", "joblist")
            this.show()
            layui.use('element', function(){
                    var $ = layui.jquery
                        ,element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块
            });

            this.getcommentlist()
        },
        methods: {

            apply(jobid){
                axios.post('checkmember', qs.stringify({
                })).then(response => {
                    if(response.data.data==200){

                        this.sessionmember = response.data.sessionmember
                        axios.post('issavevitae', qs.stringify({
                            memberid:this.sessionmember.id
                        })).then(response => {
                            if(response.data.data==200){
                                layer.confirm('是否提交简历？', {
                                    btn: ['是','否'] //按钮
                                }, function(){

                                    axios.post('applyAdd', qs.stringify({
                                        jobid:jobid,
                                    })).then(response => {
                                        if(response.data.data==200){
                                            layer.msg("提交成功！",{icon:6})
                                        }else if(response.data.data==300){
                                            layer.msg("操作异常，请重新登录！",{icon:6})
                                        }else{
                                            location.replace("login.html")
                                        }
                                    }).catch(error => {
                                        console.log(error)
                                    })

                                }, function(){
                                });

                            }else{
                                layer.msg("请先填写简历信息",{icon:7})
                            }
                        }).catch(error => {
                            console.log(error)
                        })

                    }else{
                        location.replace("login.html");
                    }
                }).catch(error => {
                    console.log(error)
                })
            },

            show() {
                axios.post('jobShow', qs.stringify({
                    id: this.id,
                })).then(response => {
                    this.job = response.data.job
                    this.welfarearray = this.job.welfarearr.split(",");
                }).catch(error => {
                    console.log(error)
                })
            },
            dz(id,flag){
                axios.post('jobDZ', qs.stringify({
                    id: this.id,
                    flag:flag,
                })).then(response => {
                    if(response.data.data==200){
                        this.job = response.data.job
                        this.show()
                    }else{
                        layer.msg("请先登录!",{icon:5})
                    }

                }).catch(error => {
                        console.log(error)
                })
            },
            topl(id){
                var index = layer.open({
                    title:"职位评论",
                    type:2,
                    area:['600px','450px'],
                    maxmin:true,
                    content:"jobpladd.html?id="+id
                })
            },
            getcommentlist(){
                axios.post('commentLb',qs.stringify({
                    jobid:id,
                    pageSize:this.pageSize
                })).then(response =>{
                    layui.use(['laypage', 'layer'], function(){
                    var laypage = layui.laypage
                        ,layer = layui.layer;
                    //总页数大于页码总数
                    laypage.render({
                        elem: 'demo1'
                        ,limit:vmm.pageSize
                        ,curr:vmm.pageNum
                        ,theme:"#2042e3"
                        ,count: response.data.list.length //数据总数
                        ,jump: function(obj,first){
                            vmm.pageNum = obj.curr
                            vmm.current_page(obj.curr,vmm.pageSize)
                            console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                        }
                    });
                });
            }).catch(error =>{
                    console.log(error)
            })
            },
            current_page(page,pageSize){
                axios.post('commentLb',qs.stringify({
                    jobid:id,
                    pageNum:page,
                    pageSize:pageSize,
                })).then(response =>{
                    this.commentlist = response.data.pageInfo.list
            }).catch(error =>{
                    console.log(error)
            })
            },

        },




    })
    window.onload = function () {
        $("#iframetop").load("top.html")
        $("#iframefoot").load("foot.html")
    }
</script>
</body>
</html>